
{% extends "base.html" %}
{% load static %}
{% block content %}

<div class="book-detail-container">
    <!-- Left Content Column -->
    <div class="left-content">
        <!-- Main Book Information Section -->
        <div class="book-main-section">
            <!-- Book Picture - Top Left Corner-->
            <div class="book-image-container">
                {% if book.image %}
                    <img src="{{ book.image.url }}" alt="Book.title" class="book-cover">
                {% else %}
                    <div class="book-placeholder">
                        <i class="fas fa-book"></i>
                        <p>No Image </p>
                    </div>
                {% endif %}
            </div>

            <!-- Book Blurb Section -->
            <div class="book-blurb-container">
                <div class="book-blurb-frame">
                    <h4>About This Book</h4>
                    {% if book.blurb %}
                        <div class="book-blurb-text">
                            {{ book.blurb|linebreaks }}
                        </div>
                    {% else %}
                        <p class="text-muted">No book description available</p>
                    {% endif %}
                </div>
            </div>

            <!-- Book Details - Right of Picture -->
            <div class="book-details-container">
                <h1 class="book-title">{{ book.title }}</h1>
                <h3 class="book-author">{{ book.author }}</h3>

                {% if book.publisher %}
                <div class="book-publisher">
                    <strong>Publisher:</strong> {{ book.publisher }}
                </div>
                {% endif %}

                <div class="book-genre">
                    <strong>Genre:</strong>
                    {% if book.genre.all %}
                        {% for genre in book.genre.all %}
                            <span class="badge bg-secondary"> {{ genre.genre_name }}</span>
                            {% if not forloop.last %}, {% endif%}
                        {% endfor %}
                    {% else %}
                        <span class="text-muted">None</span>
                    {% endif %}
                </div>


                {% if book.published_date %}
                <div class="book-info">
                    <strong>Published:</strong> {{ book.published_date|date:"M d, Y" }}
                </div>
                {% endif %}

                {% if book.ean %}
                <div class="book-info">
                    <strong>EAN:</strong> {{ book.ean }}
                </div>
                {% endif %}

                {% if book.isbn %}
                <div class="book-info">
                    <strong>ISBN:</strong> {{ book.isbn }}
                </div>
                {% endif %}

                {% if book.rating %}
                <div class="book-rating">
                    <strong>Rating:</strong>
                    {% for i in "12345"|make_list %}
                        {% if forloop.counter <= book.rating %}
                            <i class="fas fa-star text-warning"></i>
                        {% else %}
                            <i class="far fa-star text-muted"></i>
                        {% endif %}
                    {% endfor %}
                </div>
                {% endif %}
            </div>

            <!-- Social Media Links -->
            <div class="social-links">
                {% load static %}
                {% if book.facebook_url %}
                    <a href="{{ book.amazon_url }}" class="social-link amazon" title="Amazon" target="_blank" rel="noopener noreferrer">
                        <img src="{% static 'projectcv/icons/facebook.png' %}" alt="Facebook" class="social-icon-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline-block';">
                        <span class="social-text">Amazon</span>
                    </a>
                {% endif %}

                {% if book.instagram_url %}
                    <a href="{{ book.instagram_url }}" class="social-link instagram" title="Instagram" target="_blank" rel="noopener noreferrer">
                        <img src="{% static 'project/icons/instagram.png' %}" alt="Instagram" class="social-icon-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline-block';">
                        <span class="social-text">Instagram</span>
                    </a>
                {% endif %}

                {% if book.amazon_url %}
                    <a href="{{ book.amazon_url }}" class="social-link amazon" title="Amazon" target="_blank" rel="noopener noreferrer">
                        <img src="{% static 'project/icons/amazon.png' %}" alt="Amazon" class="social-icon-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline-block';">
                        <span class="social-text">Amazon</span>
                    </a>
                {% endif %}
            </div>

            <!-- Authro Bio Section - Left Bottom Corner -->
            <div class="author-bio-container">
                <div class="author-bio-frame">
                    <h4>About the Author</h4>
                    {% if book.author_photo %}
                        <img src="{{ book.author_photo.url }}" alt="{{ book.author }}" class="author-photo">
                    {% else %}
                        <div class="author-photo-placeholder">
                            <i class="fas fa-user"></i>
                        </div>
                    {% endif %}
                    <div class="author-bio-text">
                        {% if book.author_bio %}
                            {{ book.author_bio|linebreaks }}
                        {% else %}
                            <p class="text-muted">No author biography available</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>





    <!-- Comments Section - Right Column -->
    <div class="comments-section">
        <h4>Reader Comments</h4>

        <!-- Comments List Scroll -->
        <div class="comments-list">
            {% for comment in book.comments.all %}
                <div class="comment-item">
                    <div class="comment-header">
                        <strong>{{ comment.user.email| default:"Anonymous" }}</strong>
                        <span class="comment-date">{{ comment.created_at| date:"M d, Y" }}</span>
                    </div>
                    <div class="comment-text">{{ comment.content }}</div>
                </div>
            {% empty %}
                <p class="no-comments">No comments yet. Be the first to comment!</p>
            {% endfor %}
        </div>

            <!-- Comment Form -->
            <div class="comment-form-container">
                <form method="post" class="comment-form">
                    {% csrf_token %}
                    <div class="form-group">
                        <textarea name="comment" placeholder="Write your comment here..." rows="3" class="form-control comment-input"></textarea>
                    </div>
                    <div class="form-actions">
                        <div class="emoji-picker">
                            <span class="emoji" data-emoji="üòä">üòä</span>
                            <span class="emoji" data-emoji="üòç">üòç</span>
                            <span class="emoji" data-emoji="üòÇ">üòÇ</span>
                            <span class="emoji" data-emoji="üòÖ">üòÖ</span>
                            <span class="emoji" data-emoji="ü§©">ü§©</span>
                            <span class="emoji" data-emoji="üôè">üôè</span>
                            <span class="emoji" data-emoji="üòî">üòî</span>
                            <span class="emoji" data-emoji="üò†">üò†</span>
                        </div>
                        <button type="submit" class="btn btn-primary">Send Comment</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
// Emoji Picker functionality
document.querySelectorAll('.emoji').forEach(emoji => {
    emoji.addEventListener('click', function() {
        const textarea= document.querySelector('.comment-input');
        const emojiValue = this.getAttribute('data-emoji');
        textarea.value += emojiValue;
        textarea.focus();
    });
});
</script>

<script>
// Detect if  FontAwesome loaded successfully
document.addEventListener('DOMContentLoaded', function() {
    // Test if FontAwesome is loaded by checking if the icon has content
    const testIcon = document.createElement('i');
    testIcon.className = 'fas fa-facebook-f';
    testIcon.style.position = 'absolute';
    testIcon.style.visibility = 'hidden';
    document.body.appendChild(testIcon);

    // Check if the icon has proper styling after a brief delay
    setTimeout(function() {
        const computerStyle = window.getComputerStyle(testIcon, ':before');
        const hasContent = computedStyle.content && computedStyle.content !=='none' && computedStyle.content !== '""';

        if (!hasContent) {
            // FontAwesome failed to load, add fallback class
            document.body.classList.add('no-font-awesome');
        }

        // Clean up test element
        document.body.removeChild(testIcon);
    }, 100);
});
</script>

{% endblock %}